<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hệ Thống Cảnh Báo Lũ</title>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to bottom, #0f172a, #020617);
  color: white;
  text-align: center;
  overflow-x: hidden;
}

/* HEADER */
h1 {
  margin-top: 20px;
  font-size: 38px;
}

/* CARD LAYOUT */
.dashboard {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 20px;
  gap: 30px;
}

/* CARD */
.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 20px;
  width: 280px;
  box-shadow: 0 0 20px rgba(0,0,0,0.4);
}

/* VALUE */
.value {
  font-size: 48px;
  font-weight: bold;
}

/* STATUS */
.status {
  font-size: 24px;
  margin-top: 10px;
}

/* GAUGE */
.gauge-container {
  width: 200px;
  height: 200px;
  margin: auto;
}

svg {
  transform: rotate(-90deg);
}

circle {
  fill: none;
  stroke-width: 15;
}

.bg {
  stroke: #334155;
}

.progress {
  stroke: #00ff88;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.8s ease;
}

/* RIVER EFFECT */
.river {
  position: fixed;
  bottom: 0;
  width: 200%;
  height: 120px;
  background: url("https://i.imgur.com/8GQZ5jR.png");
  background-size: cover;
  animation: flow 8s linear infinite;
  opacity: 0.4;
}

@keyframes flow {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* STATUS COLORS */
.safe { color: #00ff88; }
.warning { color: #ffd000; }
.danger { color: #ff3b3b; animation: blink 1s infinite; }

@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0.3; }
  100% { opacity: 1; }
}

</style>
</head>

<body>

<h1>HỆ THỐNG CẢNH BÁO LŨ</h1>

<div class="dashboard">

  <!-- Gauge Card -->
  <div class="card">
    <h2>Mực Nước</h2>
    <div class="gauge-container">
      <svg width="200" height="200">
        <circle cx="100" cy="100" r="80" class="bg"/>
        <circle cx="100" cy="100" r="80" class="progress"
                stroke-dasharray="502"
                stroke-dashoffset="502"
                id="gaugeCircle"/>
      </svg>
      <div class="value" id="value">--</div>
    </div>
  </div>

  <!-- Status Card -->
  <div class="card">
    <h2>Trạng Thái</h2>
    <div class="status" id="status">Đang kết nối...</div>
  </div>

</div>

<div class="river"></div>

<script>

const token = "aDr0xW5cnhpazhuPPuIDUQWZGmtRtAhY";
const maxWater = 2500; // điều chỉnh nếu cần

function fetchData() {

  // Lấy giá trị nước
  fetch(`https://blynk.cloud/external/api/get?token=${token}&V0`)
    .then(res => res.text())
    .then(value => {

      if (value.includes("error")) {
        document.getElementById("status").innerText = "Token sai!";
        return;
      }

      value = parseInt(value);
      document.getElementById("value").innerText = value;

      let percent = Math.min(value / maxWater, 1);
      let circumference = 2 * Math.PI * 80;
      let offset = circumference - percent * circumference;

      document.getElementById("gaugeCircle")
        .style.strokeDashoffset = offset;
    });

  // Lấy trạng thái
  fetch(`https://blynk.cloud/external/api/get?token=${token}&V1`)
    .then(res => res.text())
    .then(status => {

      const statusDiv = document.getElementById("status");
      const gauge = document.getElementById("gaugeCircle");

      statusDiv.innerText = status;
      statusDiv.className = "status";

      if (status.includes("AN TOAN")) {
        statusDiv.classList.add("safe");
        gauge.style.stroke = "#00ff88";
      }

      else if (status.includes("NGUY HIEM") && !status.includes("RAT")) {
        statusDiv.classList.add("warning");
        gauge.style.stroke = "#ffd000";
      }

      else if (status.includes("RAT")) {
        statusDiv.classList.add("danger");
        gauge.style.stroke = "#ff3b3b";
      }

    });

}

setInterval(fetchData, 1000);
fetchData();

</script>

</body>
</html>
