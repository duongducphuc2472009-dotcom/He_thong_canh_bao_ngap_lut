<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hệ Thống Cảnh Báo Ngập Lụt</title>

<style>
body{
    font-family: Arial, sans-serif;
    text-align:center;
    background: linear-gradient(to right,#74ebd5,#9face6);
    padding-top:60px;
    transition:0.5s;
}

.box{
    background:white;
    width:380px;
    margin:auto;
    padding:35px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
    transition:0.3s;
}

h1{
    color:#0077cc;
}

#value{
    font-size:55px;
    font-weight:bold;
    margin:20px 0;
    transition:0.3s;
}

.status{
    font-size:24px;
    font-weight:bold;
    margin-top:10px;
}

.safe { color:green; }
.warning { color:orange; }
.danger { color:red; animation: blink 1s infinite; }

@keyframes blink{
    0%{opacity:1;}
    50%{opacity:0.4;}
    100%{opacity:1;}
}
</style>
</head>

<body>

<div class="box">
    <h1>Mực nước hiện tại</h1>
    <div id="value">--</div>
    <div id="status" class="status">Đang kết nối...</div>
</div>

<script>

const token = "aDr0xW5cnhpazhuPPuIDUQWZGmtRtAhY";
const pin = "V2";

async function updateData(){
    try{
        const response = await fetch(`https://blynk.cloud/external/api/get?token=${token}&${pin}`);
        const text = await response.text();

        // nếu token sai
        if(text.includes("Invalid token")){
            document.getElementById("status").innerText = "Token không hợp lệ!";
            document.getElementById("status").className="status danger";
            document.getElementById("value").innerText="--";
            return;
        }

        const value = parseInt(text);

        if(isNaN(value)){
            document.getElementById("status").innerText="Không có dữ liệu";
            return;
        }

        document.getElementById("value").innerText = value;

        const status = document.getElementById("status");

        if(value < 100){
            status.innerText="An toàn";
            status.className="status safe";
            document.body.style.background="linear-gradient(to right,#74ebd5,#9face6)";
        }
        else if(value < 300){
            status.innerText="Cảnh báo";
            status.className="status warning";
            document.body.style.background="linear-gradient(to right,#fddb92,#d1fdff)";
        }
        else{
            status.innerText="Nguy hiểm!";
            status.className="status danger";
            document.body.style.background="linear-gradient(to right,#ff9a9e,#fad0c4)";
        }

    }catch(error){
        document.getElementById("status").innerText="Mất kết nối!";
        document.getElementById("status").className="status warning";
        console.error(error);
    }
}

updateData();
setInterval(updateData,3000);

</script>

</body>
</html>
